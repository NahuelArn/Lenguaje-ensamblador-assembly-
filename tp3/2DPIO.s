Escribir un programa que solicite ingresar caracteres por teclado y que recién al presionar la tecla F10
los envíe a la impresora a través de la PIO. No es necesario mostrar los caracteres en la pantalla.

;TP3 2-D

;CONFIG PIO
PA EQU 30H
PB EQU 31H

CA EQU 32H
CB EQU 33H
;CONFIG PIC
EOI EQU 20H
IMR EQU 21H
F_10 EQU 24H

ORG 1000H

FLAG DB 0
CARACTER DB ?
;SI QUISIERA IMPRIMIR CON INT 6 COMO SACO LA LONGITUD?
;FACIL LLEVO UNA VARIABLE QUE VAYA CONTANDO CUANTAS VECES SE PIDIO UN CARACTER Y ESO DESPUES LO UTILIZO COMO LONGITUD
ORG 40
PUNTEROINT DW 3000H
ORG 3000H
PUSH BX
PUSH AX

PUNTERO: NOP
MOV BX, OFFSET CARACTER ;APUNTO AL PRINCIPIO DE LA CADENA QUE PEDI
POL: NOP
IN AL, PA ;ME TRAIGO EL VALOR ACTUAL DE PA, PARA VER SI ESTA OCUPADA LA IMPRESORA
AND AL, 1 ;PONGO AL, PARA FORZAR 0, Y VER SI EL BIT DE BUSY? ESTA EN 1 (OCUPADO)
JNZ POL   ; SI ESTA OCUPADO SIGO LOPEANDO

;IMPRESORA LIBRE
MOV AL, [BX]
OUT PB, AL    ;PB LO UTIZO COMO EL ENCARGADO DE ENVIAR LA LETRA AL BUFFER DE LA IMPRESORA

;CONFIG FLIP FLOP ;FLANCO DESCENDENTE                         STROBE 0
IN AL, PA ;TOMAMOS EL ESTADO
AND AL, 0FDH
OUT PA, AL

;CONFIGURO MI FLIP-FLOP  ;FLANCO ASCENDENTE 
IN AL, PA
OR AL, 2  ;VEO QUE ONDA EL STROBE Y LO FUERZO A 1             STROBE 1
OUT PA, AL

;CONFIG FLIP FLOP ;FLANCO DESCENDENTE 
IN AL, PA ;TOMAMOS EL ESTADO                                
AND AL, 0FDH
OUT PA, AL                                                  ; STROBE 0

INC BX
;CMP BX, OFFSET FLAG
DEC CL
JNZ POL

MOV AL, EOI
OUT EOI, AL
POP AX
POP BX
INC FLAG ;ENCARGADO DE DECIRME SI YA TOCARON F10
IRET

INIC_PIO: NOP ;ENCARGADA DE INICIALIZAR EL PIO
PUSH AX
MOV AL, 11111101B ;INICIALIZO STROBE EN 0(SALIDA) Y BUSY EN 1 COMO ENTRADA
OUT CA, AL

MOV AL, 0         ;TODOS DE SALIDA
OUT CB, AL
POP AX
RET

ORG 2000H
CALL INIC_PIO
CLI ;INTERRUPCION F10F10

MOV AL, 11111110B  ;PRIMERO SE MANDA QUE TIPO DE INTERRUPCION VOY A ESCUCHAR EN ESTE CASO F10
OUT IMR, AL        ;SE CARGA EN EL IMR PARA SABER QUE INTERRUPCION VOY A ESCUCHAR Y A CUALES VOY A IGNORAR
;PREPARO MI PUNTERO
MOV AL, 10   ;}     ESTO LO USO PARA PREPARME A QUE DIRECCION DE INTERRUPCION SALTAR EN ESTE CASO ORG 40 
OUT F_10, AL ;}     POR QUE ORG 40? PORQ TODO LO QUE PONGAS EN EL LUGAR DEL 10, LO VA MULTIPLCAR X4... 10X4=40
STI


MOV BX, OFFSET CARACTER
LUPARDO: NOP
INT 6
INC BX
INC CL ;CL LO USO PARA CONTAR CUANTAS VECES VA LEER UN CARACTER
CMP FLAG, 1
JNZ LUPARDO

INT 0
END

;CONFIG PIO
PA EQU 30H
PB EQU 31H

CA EQU 32H
CB EQU 33H
;CONFIG PIC
EOI EQU 20H
IMR EQU 21H
F_10 EQU 24H

ORG 1000H
;CARACTER DB ?
FLAG DB 0
CARACTER DB ?

ORG 40
PUNTEROINT DW 3000H
ORG 3000H
PUSH BX
PUSH AX

PUNTERO: NOP
MOV BX, OFFSET CARACTER ;APUNTO AL PRINCIPIO DE LA CADENA QUE PEDI
POL: NOP
IN AL, PA ;ME TRAIGO EL VALOR ACTUAL DE PA, PARA VER SI ESTA OCUPADA LA IMPRESORA
AND AL, 1 ;PONGO AL, PARA FORZAR 0, Y VER SI EL BIT DE BUSY? ESTA EN 1 (OCUPADO)
JNZ POL   ; SI ESTA OCUPADO SIGO LOPEANDO

;IMPRESORA LIBRE
MOV AL, [BX]
OUT PB, AL    ;PB LO UTIZO COMO EL ENCARGADO DE ENVIAR LA LETRA AL BUFFER DE LA IMPRESORA

;CONFIG FLIP FLOP ;FLANCO DESCENDENTE                         STROBE 0
IN AL, PA ;TOMAMOS EL ESTADO
AND AL, 0FDH
OUT PA, AL

;CONFIGURO MI FLIP-FLOP  ;FLANCO ASCENDENTE 
IN AL, PA
OR AL, 2  ;VEO QUE ONDA EL STROBE Y LO FUERZO A 1             STROBE 1
OUT PA, AL

;CONFIG FLIP FLOP ;FLANCO DESCENDENTE 
IN AL, PA ;TOMAMOS EL ESTADO                                
AND AL, 0FDH
OUT PA, AL                                                  ; STROBE 0

INC BX
;CMP BX, OFFSET FLAG
DEC CL
JNZ POL

MOV AL, EOI
OUT EOI, AL
POP AX
POP BX
INC FLAG ;ENCARGADO DE DECIRME SI YA TOCARON F10
IRET

INIC_PIO: NOP ;ENCARGADA DE INICIALIZAR EL PIO
PUSH AX
MOV AL, 11111101B ;INICIALIZO STROBE EN 0(SALIDA) Y BUSY EN 1 COMO ENTRADA
OUT CA, AL

MOV AL, 0         ;TODOS DE SALIDA
OUT CB, AL
POP AX
RET

ORG 2000H
CALL INIC_PIO
CLI ;INTERRUPCION F10F10

MOV AL, 11111110B  ;PRIMERO SE MANDA QUE TIPO DE INTERRUPCION VOY A ESCUCHAR EN ESTE CASO F10
OUT IMR, AL        ;SE CARGA EN EL IMR PARA SABER QUE INTERRUPCION VOY A ESCUCHAR Y A CUALES VOY A IGNORAR
;PREPARO MI PUNTERO
MOV AL, 10   ;}     ESTO LO USO PARA PREPARME A QUE DIRECCION DE INTERRUPCION SALTAR EN ESTE CASO ORG 40 
OUT F_10, AL ;}     POR QUE ORG 40? PORQ TODO LO QUE PONGAS EN EL LUGAR DEL 10, LO VA MULTIPLCAR X4... 10X4=40
STI


MOV BX, OFFSET CARACTER
LUPARDO: NOP
INT 6
INC BX
INC CL ;CL LO USO PARA CONTAR CUANTAS VECES VA LEER UN CARACTER
CMP FLAG, 1
JNZ LUPARDO

INT 0
END